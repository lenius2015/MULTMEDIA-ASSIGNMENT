<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Management - OMUNJU SHOPPERS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/admin.css">
</head>
<body>
    <div class="admin-layout">
        <%- include('./partials/sidebar', { currentPage: 'customers' }) %>

        <div class="admin-main">
            <%- include('./partials/header', { pageTitle: 'Customer Management' }) %>

            <main class="admin-content">
                <div class="admin-card">
                    <div class="card-header">
                        <h2 class="card-title">Customers</h2>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-secondary" onclick="showModal('filter-customers-modal')">
                                <i class="fas fa-filter"></i>
                                Filter
                            </button>
                            <button class="btn btn-primary" onclick="exportCustomers()">
                                <i class="fas fa-download"></i>
                                Export
                            </button>
                        </div>
                    </div>

                    <!-- Search and Filters -->
                    <div style="margin-bottom: 24px;">
                        <input type="text" placeholder="Search customers by name, email..." class="form-group" style="margin: 0; max-width: 400px;">
                    </div>

                    <!-- Customers Table -->
                    <div class="admin-table">
                        <table>
                            <thead>
                                <tr>
                                    <th data-sort="name">Customer</th>
                                    <th data-sort="email">Email</th>
                                    <th data-sort="phone">Phone</th>
                                    <th data-sort="role">Role</th>
                                    <th data-sort="joined">Joined</th>
                                    <th data-sort="status">Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% customers.forEach(customer => { %>
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <img src="/images/avatar-placeholder.jpg" alt="<%= customer.name %>" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; background: #e5e7eb;">
                                            <div>
                                                <div style="font-weight: 500;"><%= customer.name %></div>
                                                <div style="font-size: 0.75rem; color: #64748b;">ID: <%= customer.id %></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td><%= customer.email %></td>
                                    <td><%= customer.phone || 'Not provided' %></td>
                                    <td>
                                        <span class="status <%= customer.role === 'admin' ? 'delivered' : 'pending' %>">
                                            <%= customer.role === 'admin' ? 'Admin' : 'User' %>
                                        </span>
                                    </td>
                                    <td><%= new Date(customer.created_at).toLocaleDateString() %></td>
                                    <td><span class="status delivered">Active</span></td>
                                    <td>
                                        <div style="display: flex; gap: 8px;">
                                            <button class="btn btn-secondary btn-sm" onclick="viewCustomer('<%= customer.id %>')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <% if (customer.role !== 'admin') { %>
                                            <button class="btn btn-danger btn-sm" onclick="toggleCustomerStatus('<%= customer.id %>')">
                                                <i class="fas fa-ban"></i>
                                            </button>
                                            <% } %>
                                        </div>
                                    </td>
                                </tr>
                                <% }); %>
                                <% if (customers.length === 0) { %>
                                <tr>
                                    <td colspan="7" style="text-align: center; color: #64748b;">No customers found</td>
                                </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div style="margin-top: 24px; display: flex; justify-content: space-between; align-items: center;">
                        <div>Showing <%= (page - 1) * limit + 1 %>-<%= Math.min(page * limit, totalCustomers) %> of <%= totalCustomers %> customers</div>
                        <div style="display: flex; gap: 8px;">
                            <% if (page > 1) { %>
                            <a href="?page=<%= page - 1 %>" class="btn btn-secondary">Previous</a>
                            <% } else { %>
                            <button class="btn btn-secondary" disabled>Previous</button>
                            <% } %>

                            <% for (let i = Math.max(1, page - 2); i <= Math.min(totalPages, page + 2); i++) { %>
                            <% if (i === page) { %>
                            <button class="btn btn-primary" disabled><%= i %></button>
                            <% } else { %>
                            <a href="?page=<%= i %>" class="btn btn-secondary"><%= i %></a>
                            <% } %>
                            <% } %>

                            <% if (page < totalPages) { %>
                            <a href="?page=<%= page + 1 %>" class="btn btn-secondary">Next</a>
                            <% } else { %>
                            <button class="btn btn-secondary" disabled>Next</button>
                            <% } %>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div class="modal" id="customer-details-modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Customer Details - <span id="customer-id">CUST-001</span></h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="customer-details-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <div>
                        <h4>Personal Information</h4>
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                            <img id="customer-avatar" src="/images/avatar-placeholder.jpg" alt="" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; background: #e5e7eb;">
                            <div>
                                <h5 id="customer-name" style="margin: 0;"></h5>
                                <p id="customer-joined" style="margin: 4px 0 0 0; color: #64748b;"></p>
                            </div>
                        </div>
                        <p><strong>Email:</strong> <span id="customer-email"></span></p>
                        <p><strong>Phone:</strong> <span id="customer-phone"></span></p>
                        <p><strong>Role:</strong> <span id="customer-role"></span></p>
                    </div>
                    <div>
                        <h4>Account Status</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div style="text-align: center; padding: 16px; background-color: #f1f5f9; border-radius: 8px;">
                                <div id="customer-role-badge" style="font-size: 1.5rem; font-weight: 600; color: #3b82f6;"></div>
                                <div style="font-size: 0.875rem; color: #64748b;">Account Type</div>
                            </div>
                            <div style="text-align: center; padding: 16px; background-color: #f1f5f9; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: 600; color: #10b981;">Active</div>
                                <div style="font-size: 0.875rem; color: #64748b;">Status</div>
                            </div>
                        </div>
                    </div>
                </div>

                <h4>Recent Orders</h4>
                <div class="admin-table" style="margin-bottom: 24px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>#ORD-2024-001</td>
                                <td>2024-01-24</td>
                                <td>Premium Cotton T-Shirt, Designer Jeans</td>
                                <td>$129.99</td>
                                <td><span class="status pending">Pending</span></td>
                            </tr>
                            <tr>
                                <td>#ORD-2024-002</td>
                                <td>2024-01-20</td>
                                <td>Leather Jacket</td>
                                <td>$199.99</td>
                                <td><span class="status delivered">Delivered</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button class="btn btn-danger" onclick="toggleCustomerStatusFromModal()">Block Customer</button>
                    <button class="btn btn-primary" onclick="sendMessageToCustomer()">Send Message</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script src="/admin.js"></script>
    <script>
        function viewCustomer(customerId) {
            // For now, just show the modal with placeholder data
            // In a real implementation, you'd fetch customer data via AJAX
            document.getElementById('customer-id').textContent = customerId;
            showModal('customer-details-modal');
        }

        function toggleCustomerStatus(customerId) {
            showConfirm('Are you sure you want to change this customer\'s status?', function() {
                showToast('Customer status updated!', 'success');
            });
        }

        function toggleCustomerStatusFromModal() {
            hideModal('customer-details-modal');
            showToast('Customer blocked!', 'warning');
        }

        function sendMessageToCustomer() {
            showToast('Message feature coming soon!', 'info');
        }

        function exportCustomers() {
            showToast('Exporting customers...', 'info');
            setTimeout(() => showToast('Customers exported successfully!', 'success'), 2000);
        }
    </script>

    <script src="/admin-buttons.js"></script>
</body>
</html>