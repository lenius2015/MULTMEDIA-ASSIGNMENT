<!-- Notification Bar -->
<div class="notification-bar">
  <div class="notification-content">
    <i class="fas fa-shipping-fast"></i>
    <span>Free shipping on orders above Tsh 50,000 | Use code: OMUNJU</span>
  </div>
</div>

<!-- Navigation Bar -->
<header class="navbar-header">
  <nav class="navbar">
    <div class="nav-container">
      <!-- Logo -->
      <div class="logo">
        <a href="<%= user ? '/dashboard' : '/' %>">
          <i class="fas fa-shopping-bag logo-icon"></i>
          <div class="logo-text" aria-label="OMUNJUSHOPPERS">
            <span class="logo-main">OMUNJU</span>
            <span class="logo-sub">SHOPPERS</span>
          </div>
        </a>
      </div>

      <!-- Search Bar - Hidden on mobile -->
      <div class="search-bar">
        <select class="search-category">
          <option value="all">All Categories</option>
        </select>
        <input type="text" id="globalSearch" placeholder="Search for products, brands and more..." aria-label="Search products">
        <button type="button" id="searchBtn" aria-label="Search">
          <i class="fas fa-search"></i>
        </button>
      </div>

      <!-- Mobile Icons (Search & Cart) -->
      <div class="mobile-icons">
        <button class="mobile-search-btn" id="mobileSearchBtn" aria-label="Search">
          <i class="fas fa-search"></i>
        </button>
        <a class="mobile-cart-btn" href="/cart" aria-label="Cart">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-badge">0</span>
        </a>
      </div>

      <!-- Mobile Hamburger -->
      <button class="hamburger" id="hamburger" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Navigation Links -->
      <ul class="nav-links" id="navLinks">
        <li><a href="<%= user ? '/dashboard' : '/' %>" class="<%= typeof page !== 'undefined' && page === 'home' ? 'active' : '' %>"><i class="fas fa-home"></i> Home</a></li>
        <li><a href="/categories" class="<%= typeof page !== 'undefined' && page === 'categories' ? 'active' : '' %>"><i class="fas fa-th-large"></i> Categories</a></li>
        <li><a href="/deals" class="<%= typeof page !== 'undefined' && page === 'deals' ? 'active' : '' %>"><i class="fas fa-fire"></i> Deals</a></li>
        <li><a href="/promotions" class="<%= typeof page !== 'undefined' && page === 'promotions' ? 'active' : '' %>"><i class="fas fa-tags"></i> Promotions</a></li>
        <li><a href="/auctions" class="<%= typeof page !== 'undefined' && page === 'auctions' ? 'active' : '' %>"><i class="fas fa-gavel"></i> Auctions</a></li>
        <li><a href="/about" class="<%= typeof page !== 'undefined' && page === 'about' ? 'active' : '' %>"><i class="fas fa-info-circle"></i> About Us</a></li>
        <li><a href="/contact" class="<%= typeof page !== 'undefined' && page === 'contact' ? 'active' : '' %>"><i class="fas fa-envelope"></i> Contact</a></li>
        <% if (user) { %>
          <li class="mobile-only"><a href="/notifications"><i class="fas fa-bell"></i> Notifications</a></li>
          <li class="mobile-only"><a href="/wishlist"><i class="fas fa-heart"></i> Wishlist</a></li>
          <li class="mobile-only"><a href="/api/profile/view"><i class="fas fa-user"></i> My Account</a></li>
        <% } else { %>
          <li class="mobile-only"><a href="/login"><i class="fas fa-sign-in-alt"></i> Login</a></li>
        <% } %>
      </ul>

      <!-- Right Side Icons - Hidden on mobile -->
      <div class="nav-icons">
        <% if (user) { %>
          <a href="/notifications" class="nav-icon-link" title="Notifications" style="position: relative;">
            <i class="fas fa-bell"></i>
            <span class="icon-label">Notifications</span>
            <span class="notification-badge" id="notificationBadge" style="display: none;"></span>
          </a>
          <a href="/wishlist" class="nav-icon-link" title="My Wishlist" style="position: relative;">
            <i class="fas fa-heart"></i>
            <span class="icon-label">Wishlist</span>
            <span class="wishlist-badge" id="wishlistBadge" style="display: none;"></span>
          </a>
          <a href="/api/profile/view" class="nav-icon-link" title="My Profile">
            <img src="<%= user && user.profile_picture ? user.profile_picture : '/images/default-avatar.png' %>" alt="Profile" class="nav-profile-picture">
            <span class="icon-label">Profile</span>
          </a>
          <a href="/api/profile/view" class="nav-icon-link" title="My Account">
            <i class="fas fa-user-circle"></i>
            <span class="icon-label">Account</span>
          </a>
        <% } else { %>
          <a href="/login" class="nav-icon-link" title="Login">
            <i class="fas fa-user"></i>
            <span class="icon-label">Login</span>
          </a>
        <% } %>
        
        <a class="nav-icon-link cart-icon" href="/cart" title="Shopping Cart">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-badge">0</span>
          <span class="icon-label">Cart</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- Mobile Search Overlay -->
  <div class="mobile-search-overlay" id="mobileSearchOverlay">
    <div class="mobile-search-container">
      <button class="mobile-search-close" id="mobileSearchClose"><i class="fas fa-times"></i></button>
      <div class="search-bar">
        <select class="search-category" id="mobileSearchCategory">
          <option value="all">All Categories</option>
        </select>
        <input type="text" id="mobileSearchInput" placeholder="Search for products, brands and more...">
        <button type="button" id="mobileSearchBtnAction">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Secondary Navigation -->
  <div class="secondary-nav">
    <div class="nav-container">
      <div class="category-menu">
        <button class="category-menu-btn" id="categoryMenuBtn">
          <i class="fas fa-bars"></i>
          <span>All Categories</span>
        </button>
        <div class="category-dropdown" id="categoryDropdown">
          <!-- Categories loaded dynamically -->
        </div>
      </div>
      <div class="quick-links">
        <a href="/deals">Today's Deals</a>
        <a href="/promotions">New Arrivals</a>
        <a href="/auctions">Trending</a>
        <a href="/products">Best Sellers</a>
      </div>
    </div>
  </div>
</header>

<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

<style>
  /* Base Styles */
  :root {
    --primary-orange: #ff6b35;
    --primary-blue: #004e89;
    --accent-amber: #f77f00;
    --white: #ffffff;
    --light-gray: #f8f9fa;
    --dark-gray: #333;
    --border-color: #e0e0e0;
  }

  .notification-bar {
    background: var(--primary-orange);
    color: white;
    padding: 8px 0;
    text-align: center;
    font-size: 14px;
  }

  .notification-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  /* Navbar Styles */
  .navbar-header {
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
  }

  .navbar {
    padding: 15px 0;
  }

  .nav-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
  }

  /* Logo */
  .logo a {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
  }

  .logo-icon {
    font-size: 28px;
    color: var(--primary-orange);
  }

  .logo-text {
    display: flex;
    flex-direction: column;
  }

  .logo-main {
    font-size: 20px;
    font-weight: 700;
    color: var(--primary-blue);
    line-height: 1.2;
  }

  .logo-sub {
    font-size: 12px;
    color: var(--primary-orange);
    letter-spacing: 2px;
  }

  /* Search Bar */
  .search-bar {
    display: flex;
    flex: 1;
    max-width: 600px;
    border: 2px solid var(--border-color);
    border-radius: 25px;
    overflow: hidden;
  }

  .search-category {
    border: none;
    background: var(--light-gray);
    padding: 12px 16px;
    border-right: 1px solid var(--border-color);
    font-size: 14px;
    cursor: pointer;
  }

  .search-bar input {
    flex: 1;
    border: none;
    padding: 12px 16px;
    font-size: 14px;
  }

  .search-bar input:focus {
    outline: none;
  }

  .search-bar button {
    background: var(--primary-orange);
    color: white;
    border: none;
    padding: 12px 20px;
    cursor: pointer;
    transition: background 0.3s;
  }

  .search-bar button:hover {
    background: var(--accent-amber);
  }

  /* Navigation Links */
  .nav-links {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 5px;
  }

  .nav-links a {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    text-decoration: none;
    color: var(--dark-gray);
    font-size: 14px;
    font-weight: 500;
    border-radius: 6px;
    transition: all 0.3s;
  }

  .nav-links a:hover,
  .nav-links a.active {
    background: var(--light-gray);
    color: var(--primary-orange);
  }

  .nav-links a i {
    font-size: 14px;
  }

  /* Nav Icons */
  .nav-icons {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .nav-icon-link {
    display: flex;
    align-items: center;
    gap: 6px;
    text-decoration: none;
    color: var(--dark-gray);
    font-size: 14px;
    padding: 8px;
    border-radius: 6px;
    transition: all 0.3s;
  }

  .nav-icon-link:hover {
    background: var(--light-gray);
    color: var(--primary-orange);
  }

  .nav-profile-picture {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
  }

  .cart-badge {
    position: absolute;
    top: 0;
    right: 0;
    background: var(--primary-orange);
    color: white;
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
  }

  .nav-icon-link[title="Notifications"],
  .nav-icon-link[title="My Wishlist"],
  .nav-icon-link.cart-icon {
    position: relative;
  }

  /* Hamburger Menu */
  .hamburger {
    display: none;
    flex-direction: column;
    gap: 5px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
  }

  .hamburger span {
    display: block;
    width: 25px;
    height: 3px;
    background: var(--dark-gray);
    border-radius: 3px;
    transition: all 0.3s;
  }

  .hamburger.active span:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .hamburger.active span:nth-child(2) {
    opacity: 0;
  }

  .hamburger.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -6px);
  }

  /* Mobile Icons */
  .mobile-icons {
    display: none;
    align-items: center;
    gap: 15px;
  }

  .mobile-search-btn,
  .mobile-cart-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--light-gray);
    color: var(--dark-gray);
    text-decoration: none;
    position: relative;
    transition: all 0.3s;
  }

  .mobile-search-btn:hover,
  .mobile-cart-btn:hover {
    background: var(--primary-orange);
    color: white;
  }

  .mobile-cart-btn .cart-badge {
    position: absolute;
    top: -2px;
    right: -2px;
    font-size: 10px;
  }

  /* Secondary Nav */
  .secondary-nav {
    background: var(--primary-blue);
    padding: 10px 0;
  }

  .secondary-nav .nav-container {
    justify-content: flex-start;
  }

  .category-menu {
    position: relative;
  }

  .category-menu-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background: white;
    color: var(--dark-gray);
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s;
  }

  .category-menu-btn:hover {
    background: var(--light-gray);
  }

  .category-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 220px;
    display: none;
    z-index: 1001;
    overflow: hidden;
  }

  .category-dropdown.show {
    display: block;
  }

  .category-dropdown-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 16px;
    text-decoration: none;
    color: var(--dark-gray);
    font-size: 14px;
    transition: background 0.3s;
  }

  .category-dropdown-item:hover {
    background: var(--light-gray);
  }

  .category-dropdown-item i {
    color: var(--primary-orange);
  }

  .quick-links {
    display: flex;
    gap: 20px;
    margin-left: auto;
  }

  .quick-links a {
    color: white;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    opacity: 0.9;
    transition: opacity 0.3s;
  }

  .quick-links a:hover {
    opacity: 1;
    text-decoration: underline;
  }

  /* Mobile Search Overlay */
  .mobile-search-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: white;
    z-index: 1002;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .mobile-search-overlay.show {
    display: block;
  }

  .mobile-search-container {
    max-width: 600px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .mobile-search-close {
    background: none;
    border: none;
    font-size: 20px;
    color: var(--dark-gray);
    cursor: pointer;
    padding: 5px;
  }

  /* Mobile Menu Overlay */
  .mobile-menu-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 999;
  }

  .mobile-menu-overlay.show {
    display: block;
  }

  /* Responsive Styles */
  @media (max-width: 1200px) {
    .nav-links a {
      padding: 8px 10px;
      font-size: 13px;
    }
    
    .nav-links a i {
      display: none;
    }
    
    .icon-label {
      display: none;
    }
  }

  @media (max-width: 992px) {
    .nav-links {
      position: fixed;
      top: 0;
      right: -100%;
      width: 85%;
      max-width: 350px;
      height: 100vh;
      background: white;
      flex-direction: column;
      padding: 80px 20px 20px;
      gap: 0;
      box-shadow: -4px 0 12px rgba(0,0,0,0.1);
      transition: right 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }

    .nav-links.show {
      right: 0;
    }

    .nav-links li {
      width: 100%;
    }

    .nav-links a {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-color);
      font-size: 16px;
    }

    .nav-links a i {
      display: inline-block;
      width: 24px;
    }

    .nav-links a:hover {
      background: var(--light-gray);
    }

    .nav-icons {
      display: none;
    }

    .hamburger {
      display: flex;
    }

    .mobile-icons {
      display: flex;
    }

    .search-bar {
      display: none;
    }

    .quick-links {
      display: none;
    }

    .logo-main {
      font-size: 18px;
    }

    .secondary-nav {
      display: none;
    }
  }

  @media (max-width: 768px) {
    .notification-bar {
      font-size: 12px;
      padding: 6px 10px;
    }

    .notification-content span {
      display: none;
    }

    .notification-content i {
      margin: 0 auto;
    }

    .logo-icon {
      font-size: 24px;
    }

    .logo-sub {
      display: none;
    }

    .nav-container {
      padding: 0 15px;
    }

    .mobile-icons {
      gap: 10px;
    }

    .mobile-search-btn,
    .mobile-cart-btn {
      width: 36px;
      height: 36px;
    }
  }

  @media (max-width: 480px) {
    .nav-links {
      width: 90%;
    }

    .logo-main {
      font-size: 16px;
    }
  }

  /* Mobile Only Links */
  .mobile-only {
    display: none;
  }

  @media (max-width: 992px) {
    .mobile-only {
      display: block;
    }
  }
</style>

<script>
  // Category icons mapping
  const categoryIcons = {
    't-shirts': 'fas fa-tshirt',
    't shirt': 'fas fa-tshirt',
    'tshirts': 'fas fa-tshirt',
    'jackets': 'fas fa-user-secret',
    'jacket': 'fas fa-user-secret',
    'jeans': 'fas fa-columns',
    'jean': 'fas fa-columns',
    'dresses': 'fas fa-female',
    'dress': 'fas fa-female',
    'sweaters': 'fas fa-mitten',
    'sweater': 'fas fa-mitten'
  };

  function getCategoryIcon(categoryName) {
    const normalized = categoryName.toLowerCase().replace(/\s+/g, ' ');
    return categoryIcons[normalized] || 'fas fa-tag';
  }

  function loadCategories() {
    fetch('/api/products/categories/list')
      .then(response => response.json())
      .then(data => {
        if (data.success && data.categories && data.categories.length > 0) {
          const dropdown = document.getElementById('categoryDropdown');
          const searchSelect = document.querySelector('.search-category');
          const mobileSearchCategory = document.getElementById('mobileSearchCategory');
          
          // Populate dropdown
          dropdown.innerHTML = data.categories.map(cat => {
            const slug = cat.name.toLowerCase().replace(/\s+/g, '-');
            return `<a href="/category/${slug}" class="category-dropdown-item">
              <i class="${getCategoryIcon(cat.name)}"></i> ${cat.name}
            </a>`;
          }).join('');
          
          // Update search select with categories
          const allOption = searchSelect.querySelector('option[value="all"]');
          data.categories.forEach(cat => {
            const slug = cat.name.toLowerCase().replace(/\s+/g, '-');
            
            // Desktop search
            const option = document.createElement('option');
            option.value = slug;
            option.textContent = cat.name;
            searchSelect.appendChild(option);
            
            // Mobile search
            if (mobileSearchCategory) {
              const mobileOption = document.createElement('option');
              mobileOption.value = slug;
              mobileOption.textContent = cat.name;
              mobileSearchCategory.appendChild(mobileOption);
            }
          });
        }
      })
      .catch(error => {
        console.error('Error loading categories:', error);
        // Fallback categories
        const dropdown = document.getElementById('categoryDropdown');
        dropdown.innerHTML = `
          <a href="/category/t-shirts" class="category-dropdown-item"><i class="fas fa-tshirt"></i> T-Shirts</a>
          <a href="/category/jackets" class="category-dropdown-item"><i class="fas fa-user-secret"></i> Jackets</a>
          <a href="/category/jeans" class="category-dropdown-item"><i class="fas fa-columns"></i> Jeans</a>
          <a href="/category/dresses" class="category-dropdown-item"><i class="fas fa-female"></i> Dresses</a>
          <a href="/category/sweaters" class="category-dropdown-item"><i class="fas fa-mitten"></i> Sweaters</a>
        `;
      });
  }

  // Mobile menu toggle
  function setupMobileMenu() {
    const hamburger = document.getElementById('hamburger');
    const navLinks = document.getElementById('navLinks');
    const overlay = document.getElementById('mobileMenuOverlay');

    if (hamburger && navLinks) {
      hamburger.addEventListener('click', function() {
        this.classList.toggle('active');
        navLinks.classList.toggle('show');
        overlay.classList.toggle('show');
        document.body.style.overflow = navLinks.classList.contains('show') ? 'hidden' : '';
      });

      overlay.addEventListener('click', function() {
        hamburger.classList.remove('active');
        navLinks.classList.remove('show');
        this.classList.remove('show');
        document.body.style.overflow = '';
      });

      // Close menu on link click
      navLinks.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', function() {
          hamburger.classList.remove('active');
          navLinks.classList.remove('show');
          overlay.classList.remove('show');
          document.body.style.overflow = '';
        });
      });
    }
  }

  // Category dropdown toggle
  function setupCategoryDropdown() {
    const categoryBtn = document.getElementById('categoryMenuBtn');
    const dropdown = document.getElementById('categoryDropdown');
    const overlay = document.getElementById('mobileMenuOverlay');

    if (categoryBtn && dropdown) {
      categoryBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        dropdown.classList.toggle('show');
      });

      document.addEventListener('click', function(e) {
        if (!dropdown.contains(e.target) && e.target !== categoryBtn) {
          dropdown.classList.remove('show');
        }
      });

      dropdown.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', function() {
          dropdown.classList.remove('show');
        });
      });
    }
  }

  // Mobile search toggle
  function setupMobileSearch() {
    const mobileSearchBtn = document.getElementById('mobileSearchBtn');
    const mobileSearchOverlay = document.getElementById('mobileSearchOverlay');
    const mobileSearchClose = document.getElementById('mobileSearchClose');
    const mobileSearchInput = document.getElementById('mobileSearchInput');

    if (mobileSearchBtn && mobileSearchOverlay) {
      mobileSearchBtn.addEventListener('click', function() {
        mobileSearchOverlay.classList.add('show');
        document.body.style.overflow = 'hidden';
        setTimeout(() => mobileSearchInput.focus(), 100);
      });

      mobileSearchClose.addEventListener('click', function() {
        mobileSearchOverlay.classList.remove('show');
        document.body.style.overflow = '';
      });

      mobileSearchOverlay.addEventListener('click', function(e) {
        if (e.target === mobileSearchOverlay) {
          mobileSearchOverlay.classList.remove('show');
          document.body.style.overflow = '';
        }
      });
    }
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    loadCategories();
    setupMobileMenu();
    setupCategoryDropdown();
    setupMobileSearch();
  });
</script>
